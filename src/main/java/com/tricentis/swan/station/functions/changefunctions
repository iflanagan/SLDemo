#!/bin/bash

# Set the local repo directory (you can change this as needed)
REPO_DIR="./SLDemo"
FUNCTIONS_DIR="$REPO_DIR/src/main/java/com/tricentis/swan/station/functions"

# Clone the repo if it doesn't exist
if [ ! -d "$REPO_DIR" ]; then
  echo "Cloning repo..."
#  git clone https://github.com/iflanagan/SLDemo.git
fi

# Check if the functions directory exists
if [ ! -d "$FUNCTIONS_DIR" ]; then
  echo "Functions directory not found: $FUNCTIONS_DIR"
  exit 1
fi

# Loop through each Java file in the functions directory
echo "Processing function classes..."
for file in "$FUNCTIONS_DIR"/*.java; do
  class_name=$(basename "$file" .java)
  new_comment="// Function class: $class_name - Updated automatically"

  # Create a temp file
  tmp_file=$(mktemp)

  # Replace existing comment or add if not present
  awk -v comment="$new_comment" '
    NR == 1 && $0 ~ /^\/\/ Function class:/ {
      print comment
      next
    }
    NR == 1 && $0 !~ /^\/\// {
      print comment
    }
    { print }
  ' "$file" > "$tmp_file"

  # Move temp file to original
  mv "$tmp_file" "$file"

  echo "Updated: $class_name.java"
done

echo "All function classes processed."

