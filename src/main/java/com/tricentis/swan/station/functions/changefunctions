#!/bin/bash

REPO_DIR="./SLDemo"
FUNCTIONS_DIR="/Users/i.michael-flanagan/Workspace/IanSealights/swan-java/src/main/java/com/tricentis/swan/station/functions"

# Clone the repo if it doesn't exist
if [ ! -d "$REPO_DIR" ]; then
  echo "Cloning repo..."
#  git clone https://github.com/iflanagan/SLDemo.git
fi

if [ ! -d "$FUNCTIONS_DIR" ]; then
  echo "Functions directory not found: $FUNCTIONS_DIR"
  exit 1
fi

# Fallback for systems without `shuf` using `sort -R` and `head`
selected_files=($(find "$FUNCTIONS_DIR" -maxdepth 1 -name "*.java" | sort -R | head -n 2))

echo "ðŸ”€ Randomly selected files:"
for file in "${selected_files[@]}"; do
  echo " - $(basename "$file")"
done
echo ""

for file in "${selected_files[@]}"; do
  class_name=$(basename "$file" .java)
  new_comment="// Function class: $class_name - Updated automatically"

  tmp_file=$(mktemp)

  awk -v comment="$new_comment" '
    NR == 1 && $0 ~ /^\/\/ Function class:/ {
      print comment
      next
    }
    NR == 1 && $0 !~ /^\/\// {
      print comment
    }
    { print }
  ' "$file" > "$tmp_file"

  mv "$tmp_file" "$file"
  echo " Updated: $class_name.java"
done

echo ""
echo " Done updating 2 random function classes."

