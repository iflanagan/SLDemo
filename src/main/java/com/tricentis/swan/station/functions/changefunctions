#!/bin/bash

# Set relative path to Java function classes within the repo
FUNCTIONS_DIR="./src/main/java/com/tricentis/swan/station/functions"

# Check if the directory exists
if [ ! -d "$FUNCTIONS_DIR" ]; then
  echo " Functions directory not found: $FUNCTIONS_DIR"
  exit 1
fi

# Select 2 random .java files
selected_files=($(find "$FUNCTIONS_DIR" -maxdepth 1 -name "*.java" | sort -R | head -n 2))

if [ ${#selected_files[@]} -eq 0 ]; then
  echo "⚠️ No Java function files found in $FUNCTIONS_DIR"
  exit 0
fi

echo "🔀 Randomly selected files:"
for file in "${selected_files[@]}"; do
  echo " - $(basename "$file")"
done
echo ""

# Add comment header to each selected file
for file in "${selected_files[@]}"; do
  class_name=$(basename "$file" .java)
  new_comment="// Function class: $class_name - Updated automatically"

  tmp_file=$(mktemp)

  awk -v comment="$new_comment" '
    NR == 1 && $0 ~ /^\/\/ Function class:/ {
      print comment
      next
    }
    NR == 1 && $0 !~ /^\/\// {
      print comment
    }
    { print }
  ' "$file" > "$tmp_file"

  mv "$tmp_file" "$file"
  echo "✅ Updated: $class_name.java"
done

echo ""
echo "🎉 Done updating 2 random function classes."
